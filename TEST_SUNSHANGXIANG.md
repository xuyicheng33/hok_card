# 🧪 孙尚香技能测试指南

> 测试配置：澜 + 孙尚香 vs 公孙离 + 瑶

---

## 📋 测试配置

### **队伍A（蓝方）**
```
1. 澜（刺客）
   - 攻击力：400
   - 生命值：700
   - 主动技能：鲨之猎刃（+100攻击）
   - 被动技能：狩猎（目标<50%血增伤30%）

2. 孙尚香（射手）✨ 测试目标
   - 攻击力：550
   - 生命值：625
   - 主动技能：红莲爆弹（-60护甲 + 75真伤）
   - 被动技能：千金重弩（50%概率获得1技能点）
```

### **队伍B（红方）**
```
1. 公孙离（射手）
   - 攻击力：600
   - 生命值：600
   - 闪避率：30%
   - 主动技能：晚云落（+40%暴击率）
   - 被动技能：霜叶舞（闪避成功+属性）

2. 瑶（辅助）
   - 攻击力：280
   - 生命值：850
   - 主动技能：鹿灵守心（护盾+增益）
   - 被动技能：山鬼白鹿（未实现）
```

---

## 🎯 测试目标

### **主动技能：红莲爆弹**

#### **测试点1：护甲减少**
```
操作步骤：
1. 选择孙尚香
2. 点击"技能"按钮（消耗2技能点）
3. 选择敌方目标（公孙离或瑶）
4. 观察目标护甲变化

预期结果：
✅ 目标护甲减少60点（最低到0）
✅ 双方客户端护甲值同步
✅ 消息系统显示"护甲减少"
```

#### **测试点2：真实伤害**
```
操作步骤：
1. 使用红莲爆弹攻击有护盾的目标
2. 观察伤害是否无视护盾

预期结果：
✅ 造成75点真实伤害
✅ 直接扣除生命值，不消耗护盾
✅ 双方客户端生命值同步
✅ 护盾值不变
```

#### **测试点3：技能点消耗**
```
操作步骤：
1. 确认当前技能点≥2
2. 使用红莲爆弹

预期结果：
✅ 技能点减少2点
✅ 双方客户端技能点同步
✅ 技能使用后结束当前回合
```

---

### **被动技能：千金重弩**

#### **测试点4：触发概率**
```
操作步骤：
1. 使用孙尚香进行10次普通攻击
2. 统计触发次数

预期结果：
✅ 约50%的攻击触发被动（4-6次左右）
✅ 每次触发获得1点技能点
✅ 技能点不超过6点上限
✅ 双方客户端技能点同步
```

#### **测试点5：触发条件**
```
测试条件A：攻击命中
操作：正常攻击敌方
预期：✅ 可能触发被动

测试条件B：攻击被闪避
操作：攻击公孙离，触发闪避
预期：❌ 不触发被动（因为未命中）

测试条件C：攻击无伤害
操作：攻击护甲远高于攻击力的目标
预期：❌ 不触发被动（因为伤害为0）
```

#### **测试点6：技能点上限**
```
操作步骤：
1. 使技能点达到5点
2. 使用孙尚香攻击
3. 观察触发后技能点是否超过6点

预期结果：
✅ 技能点增加到6点后停止
✅ 继续攻击可以触发被动（但不增加技能点）
✅ 服务器日志显示"技能点已满"
```

#### **测试点7：消息系统**
```
操作步骤：
1. 使用孙尚香攻击
2. 触发被动时观察消息系统

预期结果：
✅ 显示"⭐ 孙尚香 被动技能「千金重弩」触发"
✅ 显示"攻击命中，获得1点技能点"
✅ 双方客户端消息同步显示
```

---

## 🎮 完整测试流程

### **阶段1：主动技能测试**

```
回合1：
- 孙尚香初始技能点：4点
- 目标：公孙离（护甲150）

操作：
1. 选择孙尚香 → 技能 → 公孙离
2. 观察：
   ✅ 公孙离护甲：150 → 90
   ✅ 公孙离生命：600 → 525（-75真伤）
   ✅ 孙尚香技能点：4 → 2
   ✅ 回合结束

回合2：
- 观察公孙离护甲是否保持为90
- 验证护甲减少效果持续
```

### **阶段2：被动技能测试**

```
回合3-12：（10次攻击）
- 孙尚香当前技能点：2点
- 目标：公孙离或瑶

操作：
1. 每回合使用孙尚香攻击
2. 记录每次是否触发被动
3. 统计触发次数

预期统计：
- 攻击次数：10次
- 触发次数：约4-6次
- 技能点变化：2 → 6（上限）
- 触发率：约40%-60%

记录表格：
| 回合 | 目标 | 伤害 | 是否触发 | 技能点 |
|------|------|------|---------|--------|
| 3    | 公孙离 | 450 | 是 ✅ | 2→3 |
| 4    | 瑶    | 370 | 否 ❌ | 3   |
| 5    | 公孙离 | 450 | 是 ✅ | 3→4 |
| ...  | ...   | ... | ...   | ... |
```

### **阶段3：组合测试**

```
测试场景：连续使用主动+被动

操作序列：
1. 使用红莲爆弹（消耗2技能点）
2. 等待回合结束
3. 下回合普通攻击（可能触发被动+1技能点）
4. 重复10次

验证：
✅ 主动技能正常消耗技能点
✅ 被动技能正常获得技能点
✅ 技能点在合理范围内波动（0-6）
✅ 双方客户端完全同步
```

---

## 🐛 常见问题排查

### **问题1：被动技能不触发**
```
检查项：
□ 是否攻击命中（未被闪避）
□ 是否造成了伤害（>0）
□ 技能点是否已满（6/6）
□ 服务器日志是否有错误
```

### **问题2：技能点不同步**
```
检查项：
□ 双方客户端是否都收到skill_points_updated信号
□ 服务器返回的team字段是否正确
□ BattleScene是否正确监听信号
□ 查看控制台是否有"⭐ 孙尚香被动"日志
```

### **问题3：真实伤害被护盾吸收**
```
检查项：
□ 服务器端是否直接扣除health（不经过护盾）
□ 客户端是否使用服务器的target_health
□ 查看战斗日志中的护盾值变化
```

### **问题4：护甲减少不生效**
```
检查项：
□ 服务器端是否修改了target.armor
□ 客户端是否同步了target_armor值
□ 后续攻击是否使用了新的护甲值
```

---

## 📊 性能验证

### **联机同步测试**

```
测试环境：
- 服务器：http://121.199.78.133:3000
- 客户端A：房主
- 客户端B：加入者

测试步骤：
1. 客户端A选择澜+孙尚香
2. 客户端B选择公孙离+瑶
3. 进入战斗
4. 执行上述所有测试点
5. 对比双方客户端显示

验证项：
✅ 技能点数值完全一致
✅ 生命值/护甲值完全一致
✅ 被动触发时机完全一致
✅ 战斗日志完全一致
✅ 无延迟或卡顿
```

---

## 🎯 成功标准

```
主动技能（红莲爆弹）：
✅ 护甲减少60点（正确）
✅ 造成75真实伤害（正确）
✅ 无视护盾（正确）
✅ 消耗2技能点（正确）
✅ 结束回合（正确）
✅ 双方同步（正确）

被动技能（千金重弩）：
✅ 攻击命中时判定（正确）
✅ 50%触发概率（正确）
✅ 获得1技能点（正确）
✅ 不超过6点上限（正确）
✅ 未命中不触发（正确）
✅ 双方同步（正确）

综合评分：12/12 = 100% ✅
```

---

## 📝 测试记录模板

```
测试日期：________
测试人员：________
服务器版本：________
客户端版本：________

主动技能测试：
□ 护甲减少：通过/失败
□ 真实伤害：通过/失败
□ 技能点消耗：通过/失败
□ 结束回合：通过/失败

被动技能测试：
□ 触发概率：通过/失败（触发次数：__/10）
□ 技能点获取：通过/失败
□ 上限限制：通过/失败
□ 命中判定：通过/失败

联机同步测试：
□ 技能点同步：通过/失败
□ 属性同步：通过/失败
□ 消息同步：通过/失败
□ 无延迟：通过/失败

问题记录：
_______________________________
_______________________________
_______________________________
```

---

## 🚀 快速测试命令

### **启动服务器**
```bash
cd f:/QQ/Downloads/hok_card/server
npm start
```

### **查看服务器日志**
```bash
# 观察以下关键日志：
[孙尚香技能] 护甲减少、真实伤害
⭐ 孙尚香被动「千金重弩」触发
```

### **查看客户端日志**
```
在Godot控制台搜索：
- "孙尚香"
- "千金重弩"
- "技能点"
- "被动"
```

---

**测试完成后，请在Discord/钉钉报告测试结果！** ✅
