# 3v3联机模式测试指南

## ✅ **已配置：3v3默认阵容**

### 蓝方（房主/先手）
```
1. 孙尚香（射手）
   攻击: 550  生命: 625  护甲: 175
   暴击率: 15%
   主动技能: 红莲爆弹（减护甲+真实伤害）消耗2点
   被动技能: 千金重弩（攻击命中70%获得1技能点）✅已实现

2. 澜（刺客）
   攻击: 400  生命: 700  护甲: 250
   暴击率: 10%
   主动技能: 鲨之猎刃（增加攻击力100）消耗2点
   被动技能: 狩猎（目标<30%血时额外50%伤害）✅已实现

3. 大乔（辅助）
   攻击: 300  生命: 800  护甲: 150
   暴击率: 10%
   主动技能: 沧海之曜（AOE真实伤害）消耗4点
   被动技能: 宿命之海（受致命伤→1血+3技能点）✅新实现
```

### 红方（客户端/后手）
```
1. 公孙离（射手）
   攻击: 600  生命: 600  护甲: 150
   暴击率: 20%  闪避率: 30%
   主动技能: 晚云落（+50%暴击率）消耗3点
   被动技能: 霜叶舞（闪避+暴击联动增益）✅已实现

2. 瑶（辅助）
   攻击: 280  生命: 850  护甲: 200
   暴击率: 0%
   主动技能: 鹿灵守心（护盾+属性增益）消耗2点
   被动技能: 山鬼白鹿（受伤时为最低血量友方加护盾）✅已实现

3. 杨玉环（辅助）
   攻击: 400  生命: 700  护甲: 150
   暴击率: 15%
   主动技能: 惊鸿曲（生命值动态AOE）消耗2点
   被动技能: 霓裳风华（技能后持续效果）❌未实现
```

---

## 🎯 **阵容特点分析**

### 蓝方优势
- **爆发能力强**：孙尚香+澜双输出
- **技能点回复**：孙尚香被动快速积累技能点
- **容错率高**：大乔被动提供关键复活
- **控制节奏**：先手优势，可主导战斗

### 红方优势
- **生存能力强**：公孙离闪避+瑶护盾双保险
- **暴击输出**：公孙离20%基础暴击+技能50%
- **团队协作**：瑶被动保护低血量队友
- **后发制人**：可根据蓝方行动调整策略

### 平衡性
```
蓝方总攻击力: 550 + 400 + 300 = 1250
红方总攻击力: 600 + 280 + 400 = 1280  (+30)

蓝方总生命值: 625 + 700 + 800 = 2125
红方总生命值: 600 + 850 + 700 = 2150  (+25)

技能消耗对比:
蓝方: 2+2+4 = 8点（平均2.67）
红方: 3+2+2 = 7点（平均2.33）

结论: 双方基本平衡，略偏向红方
```

---

## 🧪 **测试场景**

### 场景1：大乔被动触发测试
```
目标：验证大乔「宿命之海」完整功能

操作：
1. 创建房间（蓝方为房主）
2. 用红方集火攻击大乔
3. 将大乔打至0血

预期结果：
✅ 大乔生命值：0 → 1
✅ 蓝方技能点：X → X+3（或6上限）
✅ 如果溢出：每1点→150护盾
✅ 服务器日志显示被动触发
✅ 客户端UI同步更新
✅ 战斗消息记录被动

后续测试：
- 再次击杀大乔，验证被动不会二次触发
- 验证 daqiao_passive_used = true
```

### 场景2：瑶被动联动测试
```
目标：验证瑶「山鬼白鹿」为队友加护盾

操作：
1. 攻击瑶，触发被动
2. 观察最低血量队友获得护盾

预期结果：
✅ 瑶受到伤害
✅ 自动找到血量最低的红方队友
✅ 目标获得护盾（200点）
✅ 服务器日志显示受益者
✅ 客户端UI显示护盾值

边界测试：
- 瑶自己血量最低时，给自己加盾
- 队友满血时，给谁加盾
- 队友死亡时，是否正确跳过
```

### 场景3：孙尚香技能点积累
```
目标：验证孙尚香快速积累技能点

操作：
1. 用孙尚香持续攻击
2. 观察技能点增长

预期结果：
✅ 每次攻击命中70%触发
✅ 技能点+1（不超过6）
✅ 配合澜技能快速爆发
✅ 服务器日志显示触发概率

战术测试：
- 配合澜技能增加攻击力
- 快速积累到6点技能点
- 大乔释放AOE技能
```

### 场景4：公孙离闪避+暴击连锁
```
目标：验证公孙离被动联动机制

操作：
1. 攻击公孙离，观察闪避
2. 公孙离攻击，观察暴击
3. 暴击后观察闪避率提升

预期结果：
✅ 基础30%闪避率生效
✅ 闪避成功获得增益
✅ 暴击后闪避率提升
✅ 服务器日志显示闪避和增益

连锁测试：
- 闪避→攻击力+50，暴击率+10%
- 暴击→闪避率+20%
- 持续攻击形成正反馈
```

### 场景5：3v3团队协作
```
目标：验证多英雄协作效果

蓝方战术：
1. 孙尚香先手积累技能点
2. 澜斩杀低血量目标
3. 大乔AOE收割或复活保护

红方战术：
1. 公孙离高输出配合闪避
2. 瑶保护队友提供护盾
3. 杨玉环动态技能支援

测试重点：
✅ 被动技能是否正确触发
✅ 技能点消耗和恢复平衡
✅ 行动点系统3人共享
✅ 多目标技能正确生效
```

### 场景6：极限压力测试
```
目标：测试系统稳定性

操作：
1. 快速连续操作（攻击+技能）
2. 同时触发多个被动技能
3. 技能点频繁变化

预期结果：
✅ 服务器不崩溃
✅ 消息不丢失
✅ UI同步正确
✅ 日志清晰完整
```

---

## 📊 **观察要点**

### 服务器端日志
```bash
# SSH连接服务器
ssh root@你的服务器IP
pm2 logs hok-card-server --lines 100

关键日志：
✅ [房间] 房间创建成功: XXXXXX
✅ [攻击计算] 角色A → 角色B
✅ ⭐ 被动技能触发（孙尚香/澜/大乔/公孙离/瑶）
✅ [行动点] 蓝方/红方 已用X次，剩余Y次
✅ [技能点] 蓝方/红方 X→Y
✅ [回合切换] 回合X → 当前玩家: host/guest
```

### 客户端日志（Godot）
```
关键输出：
✅ 🌐 连接服务器成功
✅ 房间创建成功: XXXXXX
✅ 🎮 游戏开始！
✅ 🎯 玩家使用行动：X/3
✅ 🌟 被动技能触发
✅ ✅ 技能点更新完成
✅ 📝 回合切换
```

### UI检查
```
战斗界面：
✅ 6张卡牌正确显示
✅ 生命值/护盾实时更新
✅ 技能点显示正确（蓝方/红方）
✅ 行动点显示正确（X/3）
✅ 回合指示清晰
✅ 战斗消息完整记录

卡牌信息：
✅ 英雄名称正确
✅ 属性值正确
✅ 被动技能描述
✅ 死亡状态正确
```

---

## 🐛 **已知问题提示**

### 问题1：杨玉环被动未实现
**影响**：
- 杨玉环技能后无持续效果
- 不影响主动技能使用

**临时方案**：
- 重点测试其他5个英雄
- 杨玉环作为输出辅助使用

### 问题2：行动点共享
**说明**：
- 3v3模式下，3个英雄共享3次行动
- 每次攻击/技能消耗1次
- 合理分配行动顺序

### 问题3：技能点池独立
**说明**：
- 蓝方和红方各有独立技能点池
- 初始4点，上限6点
- 每回合开始+1（第一回合除外）

---

## 🎮 **战术推荐**

### 蓝方开局战术
```
回合1：
- 孙尚香攻击公孙离（触发被动获取技能点）
- 澜蓄力或保护大乔
- 观察红方动向

回合2-3：
- 孙尚香持续攻击积累技能点
- 澜寻找低血量目标斩杀
- 大乔积累技能点准备AOE

危机应对：
- 大乔被集火：依靠被动复活+3技能点
- 孙尚香被针对：澜反击保护
```

### 红方开局战术
```
回合1（观察）：
- 公孙离攻击孙尚香（闪避+输出）
- 瑶待命或给公孙离加护盾
- 杨玉环伺机而动

回合2-3（压制）：
- 集火大乔（触发被动消耗其资源）
- 公孙离持续输出（闪避+暴击）
- 瑶保护低血量队友

战术变化：
- 大乔复活后立即击杀（不给二次机会）
- 利用瑶被动保持队伍续航
```

---

## 📝 **测试检查清单**

### 服务器端
- [ ] 代码已推送到服务器（git pull）
- [ ] 服务器已重启（pm2 restart hok-card-server）
- [ ] 服务器日志正常（pm2 logs）
- [ ] 3v3阵容配置正确
- [ ] 卡牌数据加载成功

### 客户端
- [ ] Godot项目已更新
- [ ] 能正常连接服务器
- [ ] 创建房间成功
- [ ] 6张卡牌显示正确
- [ ] UI布局正常（3v3适配）

### 功能测试
- [ ] 大乔被动「宿命之海」触发
- [ ] 技能点溢出转护盾正确
- [ ] 瑶被动「山鬼白鹿」触发
- [ ] 孙尚香被动「千金重弩」触发
- [ ] 澜被动「狩猎」斩杀增伤
- [ ] 公孙离被动「霜叶舞」联动
- [ ] 行动点共享机制正确（3次/回合）
- [ ] 技能点独立计算正确
- [ ] 回合切换正常
- [ ] 胜负判定正确

### 稳定性测试
- [ ] 连续10回合无崩溃
- [ ] 消息同步无延迟
- [ ] UI刷新流畅
- [ ] 无内存泄漏
- [ ] 日志无错误

---

## 💡 **调试技巧**

### 快速测试大乔被动
```javascript
// server.js 临时修改
const daqiaoDataLowHP = { 
  ...daqiaoData, 
  max_health: 100,  // 改为100血，方便快速击杀
  health: 100 
};

// 使用低血量版本
{ id: 'daqiao_006_blue_2', ...daqiaoDataLowHP, health: 100, shield: 0, daqiao_passive_used: false }
```

### 提高技能点初始值（测试溢出）
```javascript
// server.js line 78-81
hostSkillPoints: 5,    // 改为5点
guestSkillPoints: 5,   // 改为5点
blueSkillPoints: 5,
redSkillPoints: 5
```

### 查看实时战斗流
```bash
# 服务器端实时日志
pm2 logs hok-card-server

# 过滤关键信息
pm2 logs hok-card-server | grep -E "攻击|被动|技能点|行动点"
```

---

## 🎉 **成功标志**

当你看到以下所有内容时，说明3v3完美运行：

### 游戏流程
```
✅ 创建房间成功
✅ 双方连接成功
✅ 6张卡牌加载完成
✅ 回合制流程正常
✅ 胜负判定正确
```

### 被动技能
```
✅ 大乔被动触发（生命→1，技能点+3）
✅ 瑶被动触发（为队友加护盾）
✅ 孙尚香被动触发（获得技能点）
✅ 澜被动触发（斩杀增伤）
✅ 公孙离被动触发（闪避+暴击联动）
```

### 系统稳定
```
✅ 无崩溃、无卡顿
✅ 消息同步正确
✅ UI刷新流畅
✅ 日志清晰完整
```

**恭喜！3v3联机模式完美运行！** 🎊✨

---

## 📞 **问题反馈**

如果遇到问题，请提供：

1. **服务器版本**
   ```bash
   git log --oneline -1
   ```

2. **操作步骤**
   - 详细描述你的操作
   - 预期结果 vs 实际结果

3. **日志**
   - 服务器日志（pm2 logs）
   - 客户端日志（Godot控制台）

4. **截图**
   - 游戏界面
   - 错误提示

5. **测试环境**
   - 房主还是客户端
   - 回合数
   - 当前技能点/行动点

祝测试顺利！🚀
